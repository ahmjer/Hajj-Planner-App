import streamlit as st
import math
import pandas as pd

# -------------------------------------------------------------------
# ุงูุฏูุงู ุงููุณุงุนุฏุฉ ููุญุณุงุจ (Logic)
# -------------------------------------------------------------------

def calculate_time_based_staff(total_events, time_per_event_min, service_days, staff_work_hours_day, reserve_factor):
    """ุชุญุณุจ ุงูููู ุงูุนุงููุฉ ููุฅุฏุงุฑุงุช ุงูุชู ุชุนุชูุฏ ุนูู ุงูุฒูู (ูุซู ุงูุงุณุชูุจุงู)."""
    
    time_per_event_hrs = time_per_event_min / 60
    total_hours_needed = total_events * time_per_event_hrs
    total_staff_available_hours = service_days * staff_work_hours_day
    
    if total_staff_available_hours > 0:
        basic_staff = math.ceil(total_hours_needed / total_staff_available_hours)
    else:
        basic_staff = 0
    
    # ูุง ูุทุจู ุงูุงุญุชูุงุท ููุงุ ุจู ูุทุจูู ุนูู ุงูุฅุฌูุงูู ุจุนุฏ ุงูุชูุฒูุน ุงููุฑูู
    return {'Basic': basic_staff, 'Total': basic_staff, 'CalcType': 'Time'}

def calculate_ratio_based_staff(num_hajjaj, ratio, reserve_factor):
    """ุชุญุณุจ ุงูููู ุงูุนุงููุฉ ููุฅุฏุงุฑุงุช ุงูุชู ุชุนุชูุฏ ุนูู ุงูุชุบุทูุฉ (ุญุงุฌ/ููุธู)."""
    
    basic_staff = math.ceil(num_hajjaj / ratio)
    # ูุง ูุทุจู ุงูุงุญุชูุงุท ููุงุ ุจู ูุทุจูู ุนูู ุงูุฅุฌูุงูู ุจุนุฏ ุงูุชูุฒูุน ุงููุฑูู
    return {'Basic': basic_staff, 'Total': basic_staff, 'CalcType': 'Ratio'}

def distribute_staff(total_basic_staff, ratio_supervisor, ratio_assistant_head, ratio_head):
    """
    ุชูุฒูุน ุฅุฌูุงูู ุงูุงุญุชูุงุฌ (ุงูููุฏููู) ุฅูู ุงููุฑู ุงูุฅุฏุงุฑู.
    """
    
    # 5. ููุฏู ุฎุฏูุฉ (ูุณุงูู ุงูุงุญุชูุงุฌ ุงูุฃุณุงุณู ููุฅุฏุงุฑุฉ)
    ููุฏู_ุฎุฏูุฉ = total_basic_staff  
    
    # 3+4. ุงููุดุฑููู (ููุฏุงูู ูุฅุฏุงุฑู)
    ูุดุฑููู_ุงุฌูุงูู = math.ceil(ููุฏู_ุฎุฏูุฉ / ratio_supervisor)
    
    # 2. ูุณุงุนุฏ ุฑุฆูุณ
    ูุณุงุนุฏ_ุฑุฆูุณ = math.ceil(ูุดุฑููู_ุงุฌูุงูู / ratio_assistant_head)
    
    # 1. ุฑุฆูุณ
    ุฑุฆูุณ = math.ceil(ูุณุงุนุฏ_ุฑุฆูุณ / ratio_head)

    # 6. ุฅุฏุงุฑู (ูุธููุฉ ุฏุนู ููู ุฅุฏุงุฑุฉ)
    ุฅุฏุงุฑู = 1 
    
    return {
        'ุฑุฆูุณ': ุฑุฆูุณ,
        'ูุณุงุนุฏ ุฑุฆูุณ': ูุณุงุนุฏ_ุฑุฆูุณ, 
        'ูุดุฑู ููุฏุงูู': math.ceil(ูุดุฑููู_ุงุฌูุงูู * 0.7), 
        'ูุดุฑู ุงุฏุงุฑู': ูุดุฑููู_ุงุฌูุงูู - math.ceil(ูุดุฑููู_ุงุฌูุงูู * 0.7), 
        'ููุฏู ุฎุฏูุฉ': ููุฏู_ุฎุฏูุฉ, 
        'ุงุฏุงุฑู': ุฅุฏุงุฑู
    }
# -------------------------------------------------------------------
# ุชุญุฏูุฏ ุงูุฅุฏุงุฑุงุช ูุชุตููููุง
# -------------------------------------------------------------------

DEPARTMENTS = {
    "ูุฑุงูุฒ ุงูุถูุงูุฉ": [
        {'name': 'ูุฑูุฒ ุงูุถูุงูุฉ', 'type': 'Ratio', 'default_ratio': 75},
        # **ุงูุฎุฏูุงุช ุงูููุฏุงููุฉ ูุงูุฅุณูุงู ูุญุฐููุฉ**
    ],
    "ุงูุงุณุชูุจุงู ูุงููุบุงุฏุฑุฉ": [
        {'name': 'ุงุณุชูุจุงู ุงููุฌุฑุฉ', 'type': 'Time', 'default_time': 2.0},
        {'name': 'ุงุณุชูุจุงู ุงููุทุงุฑ', 'type': 'Time', 'default_time': 3.0},
        {'name': 'ุงุณุชูุจุงู ุงููุทุงุฑ', 'type': 'Time', 'default_time': 1.5},
        {'name': 'ุฅุฑุดุงุฏ ุงูุญุงููุงุช', 'type': 'Bus_Ratio', 'default_ratio': 2},
    ],
    "ุงูุฏุนู ูุงููุณุงูุฏุฉ": [
        {'name': 'ุงููุชุงุจุนุฉ ุงูููุฏุงููุฉ', 'type': 'Ratio', 'default_ratio': 100},
        {'name': 'ุงูุฏุนู ูุงูุถูุงูุฉ', 'type': 'Ratio', 'default_ratio': 80},
        {'name': 'ุงูุชูุฌูู', 'type': 'Ratio', 'default_ratio': 90},
        {'name': 'ุงูุฒูุงุฑุฉ ูุฅุฑุดุงุฏ ุงูุชุฃููู', 'type': 'Time', 'default_time': 2.5},
        {'name': 'ุงูุฑุนุงูุฉ ุงูุตุญูุฉ', 'type': 'Ratio', 'default_ratio': 200},
    ]
}

# -------------------------------------------------------------------
# ูุงุฌูุฉ ุงููุณุชุฎุฏู (Streamlit UI)
# -------------------------------------------------------------------

st.set_page_config(page_title="๐ ูุฎุทุท ุงูููู ุงูุนุงููุฉ ููุญุฌ (ุจุฃููุงุน ุงูุฅุฏุงุฑุงุช)", layout="wide") 

st.title("๐ ุฃุฏุงุฉ ุชุฎุทูุท ุงูููู ุงูุนุงููุฉ ุงูุฐููุฉ")
st.markdown("---")

# -------------------------------------------------------------------
# ุงููุณู ุงูุฃูู: ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ูููุน ุงูุฅุฏุงุฑุฉ
# -------------------------------------------------------------------

st.sidebar.header("1. ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ")

department_type_choice = st.sidebar.selectbox(
    "ุงุฎุชุฑ ููุน ุงูุฅุฏุงุฑุฉ ุงููุฑุงุฏ ุญุณุงุจู:",
    options=list(DEPARTMENTS.keys()),
    key="dept_type"
)

# ****** ุชู ุชุตุญูุญ ุฅุบูุงู ุงูููุณ
